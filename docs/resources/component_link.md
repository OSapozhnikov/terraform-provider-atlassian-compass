# compass_component_link

Manages a link attached to a Compass component. Links can be used to associate repositories, documentation, chat channels, dashboards, and other resources with a component.

## Example Usage

### Repository Link

```hcl
resource "compass_component" "example" {
  name = "My Service"
  type = "SERVICE"
}

resource "compass_component_link" "repository" {
  component_id = compass_component.example.id
  name         = "GitLab Repository"
  type         = "REPOSITORY"
  url          = "https://gitlab.com/example/service"
}
```

### Multiple Links

```hcl
resource "compass_component" "example" {
  name = "My Service"
  type = "SERVICE"
}

resource "compass_component_link" "repo" {
  component_id = compass_component.example.id
  name         = "Repository"
  type         = "REPOSITORY"
  url          = "https://gitlab.com/example/service"
}

resource "compass_component_link" "docs" {
  component_id = compass_component.example.id
  name         = "Documentation"
  type         = "DOCUMENT"
  url          = "https://docs.example.com/service"
}

resource "compass_component_link" "slack" {
  component_id = compass_component.example.id
  name         = "Team Channel"
  type         = "CHAT_CHANNEL"
  url          = "https://slack.com/channels/service"
}

resource "compass_component_link" "dashboard" {
  component_id = compass_component.example.id
  name         = "Monitoring Dashboard"
  type         = "DASHBOARD"
  url          = "https://grafana.example.com/d/service"
}
```

### Link with Object ID

```hcl
resource "compass_component_link" "repository" {
  component_id = compass_component.example.id
  name         = "Repository"
  type         = "REPOSITORY"
  url          = "https://gitlab.com/example/service"
  object_id    = "12345678"  # Repository ID from integration
}
```

## Argument Reference

The following arguments are supported:

* `component_id` - (Required, ForceNew) ID of the Compass component to attach the link to. This should be the full ARI identifier returned by `compass_component`.
* `name` - (Required) Name of the link.
* `type` - (Required) Type of the link. Valid values are:
  * `DOCUMENT` - Documentation link
  * `CHAT_CHANNEL` - Chat channel (e.g., Slack, Microsoft Teams)
  * `REPOSITORY` - Source code repository (e.g., GitLab, GitHub, Bitbucket)
  * `PROJECT` - Project management link (e.g., Jira project)
  * `DASHBOARD` - Monitoring or analytics dashboard
  * `ON_CALL` - On-call schedule or rotation
  * `OTHER_LINK` - Any other type of link
* `url` - (Required) URL of the link. Must be a valid URL format (e.g., `https://example.com`, `http://example.com`, `git://example.com/repo.git`).
* `object_id` - (Optional) The unique ID of the object the link points to. Generally, this is configured by integrations and does not need to be added to links manually. For example, the Repository ID for a Repository link.
* `cloud_id` - (Optional, Computed, ForceNew) Cloud ID of the Atlassian site. If not provided, will be automatically detected from the `tenant` configured in the provider.

## Attributes Reference

In addition to all arguments above, the following attributes are exported:

* `id` - The unique identifier (ID) of the link. This is a UUID that uniquely identifies the link within Compass.
* `cloud_id` - Cloud ID (computed if not provided explicitly)

## Import

Component links can be imported using the format `component_id:link_id` or `component_id/link_id`:

```bash
# Using colon separator
terraform import compass_component_link.repository "ari:cloud:compass:...:component/...:1d1bd8b7-2834-438b-b9e3-b63156c57bf3"

# Using slash separator
terraform import compass_component_link.repository "ari:cloud:compass:...:component/.../1d1bd8b7-2834-438b-b9e3-b63156c57bf3"
```

**Note:** The `component_id` part must be the full ARI identifier of the component, and `link_id` is the UUID of the link.

## Update Behavior

The resource supports updating the following fields:
* `name` - Can be updated
* `type` - Can be updated (changing the link type)
* `url` - Can be updated
* `object_id` - Can be updated or cleared (by setting to empty string)

**Fields that cannot be updated:**
* `component_id` - Component ID cannot be changed after creation (ForceNew).
* `cloud_id` - Cloud ID cannot be changed after creation (ForceNew).

## Notes

* Multiple links can be attached to a single component, and they can be of different types.
* The link ID is a UUID that is generated by Compass when the link is created.
* Links are read by querying the component and finding the specific link by ID.
* If `cloud_id` is not provided, the provider will automatically detect it from the `tenant` parameter in the provider configuration.
* The `object_id` field is typically used by integrations (e.g., when linking to a GitLab repository through an integration, the integration may set this to the repository ID). In most cases, you don't need to provide this manually.
* URL validation: The API validates that URLs have a valid format. Invalid formats include:
  * URLs without protocol prefix (e.g., `example.com` - should be `https://example.com`)
  * `javascript://` URLs (blocked for security)
  * Git SSH URLs without proper formatting (e.g., `git@bitbucket.org:workspace/repo.git`)

## URL Format Requirements

Valid URL formats include:
* `https://example.com`
* `http://example.com`
* `ftp://10.10.10.10`
* `git://example.com/user/project-name.git`

Invalid URL formats:
* `example.com` (missing protocol)
* `javascript://test` (blocked for security)
* `git@bitbucket.org:workspace/repo.git` (missing protocol, improper format)

